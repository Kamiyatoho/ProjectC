{% extends "base.html" %}

{% block content %}
<h1 class="text-2xl font-bold mb-6">Historique des Transactions</h1>

{% if not data or (data.deposits|length == 0 and data.trades|length == 0 and data.conversions|length == 0) %}
<p class="text-gray-400">Aucune transaction à afficher.</p>
{% else %}

<h2 class="text-xl font-semibold mb-3">Dépôts</h2>
{% if data.deposits %}
<div class="overflow-x-auto mb-6">
    <table id="deposits-table" class="stripe hover min-w-full text-sm">
        <thead class="bg-gray-700 text-gray-300">
        <tr>
            <th>Actif</th>
            <th>Montant</th>
            <th>Date</th>
        </tr>
        </thead>
        <tbody>
        {% for dep in data.deposits %}
        <tr>
            <td>{{ dep.asset }}</td>
            <td class="text-right">{{ dep.amount | round(6) }}</td>
            <td class="text-right">{{ dep.time | datetimeformat }}</td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}

<h2 class="text-xl font-semibold mb-3">Trades</h2>
{% if data.trades %}
<div class="overflow-x-auto mb-6">
    <table id="trades-table" class="stripe hover min-w-full text-sm">
        <thead class="bg-gray-700 text-gray-300">
        <tr>
            <th>Symbole</th>
            <th>Type</th>
            <th>Quantité</th>
            <th>Prix</th>
            <th>Montant</th>
            <th>Commission</th>
            <th>Date</th>
        </tr>
        </thead>
        <tbody>
        {% for t in data.trades %}
        <tr>
            <td>{{ t.symbol }}</td>
            <td class="text-right">{{ t.isBuyer and 'ACHAT' or 'VENTE' }}</td>
            <td class="text-right">{{ t.qty | round(6) }}</td>
            <td class="text-right">{{ t.price | round(6) }}</td>
            <td class="text-right">{{ t.quoteQty | round(6) }}</td>
            <td class="text-right">{{ t.commission | round(6) }} {{ t.commissionAsset }}</td>
            <td class="text-right">{{ t.time | datetimeformat }}</td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}

<h2 class="text-xl font-semibold mb-3">Conversions</h2>
{% if data.conversions %}
<div class="overflow-x-auto mb-4">
    <table id="conversions-table" class="stripe hover min-w-full text-sm">
        <thead class="bg-gray-700 text-gray-300">
        <tr>
            <th>Depuis</th>
            <th>Vers</th>
            <th>Montant (source)</th>
            <th>Montant (cible)</th>
            <th>Date</th>
        </tr>
        </thead>
        <tbody>
        {% for c in data.conversions %}
        <tr>
            <td>{{ c.fromAsset }}</td>
            <td>{{ c.toAsset }}</td>
            <td class="text-right">{{ c.fromAmount | round(6) }}</td>
            <td class="text-right">{{ c.toAmount | round(6) }}</td>
            <td class="text-right">{{ c.time | datetimeformat }}</td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}
{% endif %}
{% endblock %}

{% block extra_scripts %}
<script>
    $(document).ready(function() {
        ['#deposits-table', '#trades-table', '#conversions-table'].forEach(function(selector) {
            if (!$.fn.DataTable.isDataTable(selector)) {
                $(selector).DataTable({
                    paging: true,
                    pageLength: 15,
                    lengthMenu: [10, 25, 50, 100],
                    searching: true,
                    info: false,
                    dom: `
          <'flex justify-between items-center mb-4'
            <'flex space-x-2'B>
            <'ml-auto'f>
          >
          <'overflow-x-auto't>
          <'flex justify-between items-center mt-4'ip>
        `,
                    buttons: [
                        {
                            extend: 'csvHtml5',
                            text: 'Exporter CSV',
                        },
                        {
                            extend: 'excelHtml5',
                            text: 'Exporter Excel',
                        }
                    ]
                });
            }
        });
    });
</script>
{% endblock %}